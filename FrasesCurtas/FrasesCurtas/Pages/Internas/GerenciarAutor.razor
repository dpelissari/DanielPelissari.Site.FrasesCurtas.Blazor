@page "/int/autores/gerenciar-autor/{id?}"
@page "/int/autores/novo/"
@attribute [Authorize(Roles = "Administrador")]

@using FrasesCurtas.Componentes
@using FrasesCurtas.Models
@inject NavigationManager NavigationManager
@inject FrasesCurtas.Services.IAutorService AutorService
@layout InternasLayout

<div class="container">
    @if (modoEdicao)
    {
        <h3>Atualizar Autor</h3>

        <EditForm Model="autor" OnValidSubmit="AtualizarAutores">
            <div>
                <label>Nome</label>
                <InputText @bind-Value="autor.Nome"></InputText>
                <ValidationMessage For="@(() => autor.Nome)" />
            </div>
            <div>
                <label>Data Cadastro</label>
                <InputDate @bind-Value="autor.DataCadastro" />
                <ValidationMessage For="@(() => autor.DataCadastro)" />
            </div>
            <div>
                <label>Ativo?</label>
                <InputSelect @bind-Value="autor.Ativo">
                    <option value="true">Sim</option>
                    <option value="false">Não</option>
                </InputSelect>
                <ValidationMessage For="@(() => autor.Ativo)" />
            </div>
            <div>
                <ImagemUpload Modelo="@autor" DiretorioImagem="autores" />
                <ValidationMessage For="@(() => autor.CaminhoImagem)" />
            </div>

            <DataAnnotationsValidator />
            <button type="submit">Salvar</button>
            <NavLink href="int/autores/">Cancelar</NavLink>

        </EditForm>
    }
    else
    {
        <h3>Adicionar Autor</h3>

        <EditForm Model="autor" OnValidSubmit="CriarAutor">
            <div>
                <label>Nome</label>
                <InputText @bind-Value="autor.Nome" class="form-control" id="autornome"></InputText>
                <ValidationMessage For="@(() => autor.Nome)" />
            </div>
            <div>
                <label>Data Cadastro</label>
                <InputDate @bind-Value="autor.DataCadastro" />
                <ValidationMessage For="@(() => autor.DataCadastro)" />
            </div>
            <div>
                <label>Ativo?</label>
                <InputSelect @bind-Value="autor.Ativo" class="form-control">
                    <option value="true">Sim</option>
                    <option value="false" selected>Não</option>
                </InputSelect>
                <ValidationMessage For="@(() => autor.Ativo)" />

            </div>
            <div>
                <ImagemUpload Modelo="@autor" DiretorioImagem="autores" TextoLabel="Upload imagem" LarguraImagem="100" />
                <ValidationMessage For="@(() => autor.CaminhoImagem)" />
            </div>

            <DataAnnotationsValidator />

            <button type="submit">Incluir</button>
        </EditForm>
    }
</div>

@code {
    Autor autor = new();
    bool modoEdicao = false;

    [Parameter]
    public string id { get; set; }

    protected override async Task OnInitializedAsync() {
        if (!string.IsNullOrEmpty(id))
        {
            modoEdicao = true;
            autor = await AutorService.BuscarPor(Guid.Parse(id));
        }
    }

    async Task CriarAutor() {
        autor.GerarNovoId();
        await AutorService.Adicionar(autor);
        NavigationManager.NavigateTo("/int/autores");
    }

    async Task AtualizarAutores() {
        await AutorService.Atualizar(autor);
        NavigationManager.NavigateTo("/int/autores");
    }
}
